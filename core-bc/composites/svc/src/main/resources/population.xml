<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:oxm="http://www.springframework.org/schema/oxm"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
                            http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/oxm https://www.springframework.org/schema/oxm/spring-oxm.xsd">

    <context:property-placeholder
            location="file:${user.home}/.hotell/wwwprv/secret.properties" />

    <bean id="populationClient" class="se.vgregion.portal.wwwprv.service.ExtendedPopulationService"/>
    <bean id="litePopulationClient" class="se.vgregion.portal.wwwprv.service.FullPopulationService"/>

    <bean id="messageFactory" class="org.springframework.ws.soap.saaj.SaajSoapMessageFactory">
        <property name="soapVersion">
            <util:constant static-field="org.springframework.ws.soap.SoapVersion.SOAP_11"/>
        </property>
    </bean>

    <bean class="se.vgregion.portal.wwwprv.service.soap.LookupResidentForFullProfileResponderImpl">
        <property name="webServiceTemplate" ref="webServiceTemplate" />
        <property name="url" value="${population.service.url}/population/services/lookupResidentForFullProfile/v1"/>
    </bean>

    <bean class="se.vgregion.portal.wwwprv.service.soap.LookupResidentForExtendedProfileResponderImpl">
        <property name="webServiceTemplate" ref="webServiceTemplate" />
        <property name="url" value="${population.service.url}/population/services/lookupResidentForExtendedProfile/v1"/>
    </bean>

    <bean id="marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
        <property name="contextPaths" ref="contextPaths"/>
    </bean>

    <util:list id="contextPaths">
        <value>se.riv.population.residentmaster.lookupresidentforfullprofileresponder.v1</value>
        <value>se.riv.population.residentmaster.lookupresidentforextendedprofileresponder.v1</value>
    </util:list>

    <bean id="webServiceTemplate" class="org.springframework.ws.client.core.WebServiceTemplate">
        <constructor-arg ref="messageFactory"/>

        <property name="marshaller" ref="marshaller" />
        <property name="unmarshaller" ref="marshaller" />

        <property name="messageSender">
            <bean class="se.vgregion.portal.wwwprv.service.soap.HttpsWebServiceMessageSenderImpl" />
        </property>
    </bean>

    <bean class="se.vgregion.portal.wwwprv.service.soap.ConvenientSslContextFactory">
        <constructor-arg name="keyStore" value="${population.service.cert}" />
        <constructor-arg name="keyStorePassword" value="${population.service.password}" />
        <constructor-arg name="keyStoreType" value="PKCS12" />
        <constructor-arg name="trustStore" value="${user.home}/.hotell/wwwprv/truststore_siths_all.jks" />
        <constructor-arg name="trustStorePassword" value="changeit" />
        <constructor-arg name="trustStoreType" value="JKS" />
    </bean>

</beans>
